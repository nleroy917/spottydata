{"version":3,"sources":["../../../../build/babel/loader/index.ts"],"names":["nextBabelLoader","parentTrace","inputSource","inputSourceMap","filename","resourcePath","target","loaderOptions","traceChild","traceFn","loaderSpanInner","code","transformedSource","map","outputSourceMap","transform","call","nextBabelLoaderOuter","callback","async","loaderSpan","currentTraceSpan","id","traceAsyncFn","then","err"],"mappings":"4DAAA,4DACA,+CAEA,8D,mFAGA,cAAeA,CAAAA,eAAf,CAEEC,WAFF,CAGEC,WAHF,CAIEC,cAJF,CAKE,CACA,KAAMC,CAAAA,QAAQ,CAAG,KAAKC,YAAtB,CACA,KAAMC,CAAAA,MAAM,CAAG,KAAKA,MAApB,CACA,KAAMC,CAAAA,aAAa,CAAGN,WAAW,CAC9BO,UADmB,CACR,aADQ,EAEnBC,OAFmB,CAEX,IAAM,4BAAW,IAAX,CAFK,CAAtB,CAIA,KAAMC,CAAAA,eAAe,CAAGT,WAAW,CAACO,UAAZ,CAAuB,4BAAvB,CAAxB,CACA,KAAM,CACJG,IAAI,CAAEC,iBADF,CAEJC,GAAG,CAAEC,eAFD,EAGFJ,eAAe,CAACD,OAAhB,CAAwB,IAC1BM,mBAAUC,IAAV,CACE,IADF,CAEEd,WAFF,CAGEC,cAHF,CAIEI,aAJF,CAKEH,QALF,CAMEE,MANF,CAOEI,eAPF,CADE,CAHJ,CAeA,MAAO,CAACE,iBAAD,CAAoBE,eAApB,CAAP,CACD,CAED,KAAMG,CAAAA,oBAAoB,CAAG,QAASA,CAAAA,oBAAT,CAE3Bf,WAF2B,CAG3BC,cAH2B,CAI3B,2BACA,KAAMe,CAAAA,QAAQ,CAAG,KAAKC,KAAL,EAAjB,CAEA,KAAMC,CAAAA,UAAU,CAAG,iBAAM,yBAAN,wBAAiC,KAAKC,gBAAtC,eAAiC,sBAAuBC,EAAxD,CAAnB,CACAF,UAAU,CACPG,YADH,CACgB,IACZvB,eAAe,CAACgB,IAAhB,CAAqB,IAArB,CAA2BI,UAA3B,CAAuClB,WAAvC,CAAoDC,cAApD,CAFJ,EAIGqB,IAJH,CAKI,CAAC,CAACZ,iBAAD,CAAoBE,eAApB,CAAD,GACEI,QADF,cACEA,QAAQ,CAAG,IAAH,CAASN,iBAAT,CAA4BE,eAAe,EAAIX,cAA/C,CANd,CAOKsB,GAAD,EAAS,CACPP,QAAQ,MAAR,QAAAA,QAAQ,CAAGO,GAAH,CAAR,CACD,CATL,EAWD,CAnBD,C,aAqBeR,oB","sourcesContent":["import { getOptions } from 'next/dist/compiled/loader-utils'\nimport { trace } from '../../../telemetry/trace'\nimport { Span } from '../../../telemetry/trace'\nimport transform from './transform'\nimport { NextJsLoaderContext } from './types'\n\nasync function nextBabelLoader(\n  this: NextJsLoaderContext,\n  parentTrace: Span,\n  inputSource: string,\n  inputSourceMap: object | null | undefined\n) {\n  const filename = this.resourcePath\n  const target = this.target\n  const loaderOptions = parentTrace\n    .traceChild('get-options')\n    .traceFn(() => getOptions(this))\n\n  const loaderSpanInner = parentTrace.traceChild('next-babel-turbo-transform')\n  const {\n    code: transformedSource,\n    map: outputSourceMap,\n  } = loaderSpanInner.traceFn(() =>\n    transform.call(\n      this,\n      inputSource,\n      inputSourceMap,\n      loaderOptions,\n      filename,\n      target,\n      loaderSpanInner\n    )\n  )\n\n  return [transformedSource, outputSourceMap]\n}\n\nconst nextBabelLoaderOuter = function nextBabelLoaderOuter(\n  this: NextJsLoaderContext,\n  inputSource: string,\n  inputSourceMap: object | null | undefined\n) {\n  const callback = this.async()\n\n  const loaderSpan = trace('next-babel-turbo-loader', this.currentTraceSpan?.id)\n  loaderSpan\n    .traceAsyncFn(() =>\n      nextBabelLoader.call(this, loaderSpan, inputSource, inputSourceMap)\n    )\n    .then(\n      ([transformedSource, outputSourceMap]) =>\n        callback?.(null, transformedSource, outputSourceMap || inputSourceMap),\n      (err) => {\n        callback?.(err)\n      }\n    )\n}\n\nexport default nextBabelLoaderOuter\n"]}